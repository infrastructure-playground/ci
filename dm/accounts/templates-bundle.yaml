imports:
- path: serviceaccounts-template.jinja

resources:
- name: serviceaccounts  # commend and then uncomment when adding more service accounts, BUT BE CAREFUL THIS WILL DELETE SERVICE ACCOUNTS! JUST CREATE ANOTHER RESOURCE IF YOU WANT TO ADD
  type: serviceaccounts-template.jinja
  properties:
    projectName: resources-practice
    serviceAccountKeys:  # Service Accounts where keys will be downloaded for access purposes
      - name: storage-buckets-backend-sa
      - name: gke-cloud-sql-sa
      - name: gae-deploy-sa
      - name: gke-deploy-sa
      - name: endpoint-deploy-sa
      - name: gke-cloud-endpoint-sa
    iamMethod: add # replace to "remove" if in case you want to delete the added members using this deployment manager template
    identities: # Check roles at https://cloud.google.com/iam/docs/understanding-roles
      - role: roles/viewer
        member_type: group  # can be "user" or "serviceAccount"
        members: [manila@unnotech.com]
      - role: roles/storage.admin
        member_type: serviceAccount
        members: [$(ref.storage-buckets-backend-sa.email), $(ref.gae-deploy-sa.email)]
      - role: roles/storage.objectAdmin
        member_type: serviceAccount
        members: [$(ref.storage-buckets-backend-sa.email)]
      - role: roles/cloudsql.client
        member_type: serviceAccount
        members: [$(ref.gke-cloud-sql-sa.email)]
      - role: roles/editor
        member_type: serviceAccount
        members: [$(ref.gae-deploy-sa.email)]
      - role: roles/appengine.deployer
        member_type: serviceAccount
        members: [$(ref.gae-deploy-sa.email)]
      - role: roles/appengine.serviceAdmin
        member_type: serviceAccount
        members: [$(ref.gae-deploy-sa.email)]
      - role: roles/container.admin  # "container" is GKE roles
        member_type: serviceAccount
        members: [$(ref.gke-deploy-sa.email)]
      - role: roles/servicemanagement.admin
        member_type: serviceAccount
        members: [$(ref.endpoint-deploy-sa.email)]
      - role: roles/servicemanagement.serviceController
        member_type: serviceAccount
        members: [$(ref.gke-cloud-endpoint-sa.email)]
      - role: roles/cloudtrace.agent
        member_type: serviceAccount
        members: [$(ref.gke-cloud-endpoint-sa.email)]

# To echo data properties
outputs:
- name: storageBucketsBackendServiceKey
  value: $(ref.storage-buckets-backend-sa-keys.privateKeyData)
- name: gkeCloudSQLServiceKey
  value: $(ref.gke-cloud-sql-sa-keys.privateKeyData)
- name: gaeDeployServiceKey
  value: $(ref.gae-deploy-sa-keys.privateKeyData)
- name: gkeDeployServiceKey
  value: $(ref.gke-deploy-sa-keys.privateKeyData)
- name: endpointDeployServiceKey
  value: $(ref.endpoint-deploy-sa-keys.privateKeyData)
- name: gkeCloudEndpointServiceKey
  value: $(ref.gke-cloud-endpoint-sa-keys.privateKeyData)
